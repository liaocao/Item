window.FrontJS=function(e,t,r){"use strict";var n="https://collecter.frontjs.com/",o="https://static.frontjs.com/dist/current/tracker.min.js",a="1.0.0-alpha",i=5e3,s=1,u=2,c=4,l=8,f=256,m=512,p=513,g=514,d=515,v=768,h=769,y=770,_=771,S=772,E=1024,D=function(e,t){t=t||"";var r={1001:"Invalid token",1002:"Invalid behaviour settings",1003:"Invalid origin settings",1004:"Invalid exclude settings",1005:"Invalid user data",1006:"Invalid history API type",1007:"Invalid route mapping settings",4000:"Bad configuration! Fail to start!",4001:"FrontJS is already defined, Fail to start!"};r[e]&&console.warn(["Error(frontjs):",r[e],"(CODE"+e+")","See https://www.frontjs.com/doc/view/errcode/#"+encodeURIComponent(t)].join(" "))};if(e.FrontJS)return D(4001),e.FrontJS;var k=function(e){return e&&e.match(/^\w{32}$/)?0:1},R=function(e){return e<=(s|u|c|l)?0:1},L=function(e){e=e||[];for(var t=0;t<e.length;t++)if("string"==typeof e[t]);else if(!e[t].test)return e[t];return 0},C=function(e){e=e||[];for(var t=0;t<e.length;t++)if("string"!=typeof e[t][0]||"string"!=typeof e[t][1])return"Pair: "+e[t].join(",");return 0},I=function(e){for(var t in e=e||{})if("string"!=typeof e[t]||"string"!=typeof t)return t;return 0},w={parseRegExp:function(e){if("string"==typeof e&&e.match(/\/(.*)\/(i|g|m|u|y)*/))try{return new Function("return "+e)()}catch(e){}return null},KVArrayCopy:function(e){var t={};for(var r in e)t[r]=e[r];return t},uriArrayCopy:function(e){e=e||[];for(var t=[],r=0;r<e.length;r++)"string"==typeof e[r]&&(w.parseRegExp(e[r])?t.push(w.parseRegExp(e[r])):t.push(e[r]));return t},routeArrayCopy:function(e){e=e||[];for(var t=[],r=0;r<e.length;r++)"string"==typeof e[r][0]&&(w.parseRegExp(e[r][0])?t.push([w.parseRegExp(e[r][0]),e[r][1]]):t.push([e[r][0],e[r][1]]));return t},getTime:function(){return(new Date).getTime()},getGUID:function(){var e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],t=w.getTime().toString(16);for(t="0"+t;t.length<16;)t="f"+t;for(;t.length<32;)t+=e[Math.floor(16*Math.random())];return t},stringifyParameter:function(e){var t=[];if(e&&e.length){for(var r=0;r<e.length;r++)if(null===e[r])t.push("null");else if(void 0===e[r])t.push("undefined");else if(e[r]instanceof Array&&"string"==typeof e[r].toString())t.push("["+e[r].toString()+"]");else if("object"==typeof e[r]){var n=[];for(var o in e[r]){var a="";if(a+=o+": ",null===e[r][o])a+="null";else if(void 0===e[r][o])a+="undefined";else{switch(typeof e[r][o]){case"object":e[r][o]instanceof Array&&"string"==typeof e[r][o].toString()?a+="["+e[r][o].toString()+"]":"string"==typeof e[r][o].valueOf()?a+=e[r][o].toString():"string"==typeof e[r][o].toString()?a+=e[r][o].toString():a+="[object]";break;case"function":a+="[function]";break;default:a+=e[r][o].toString()}}n.push(a)}t.push("{"+n.join(", ")+"}")}else"string"==typeof e[r].valueOf()?t.push(e[r].valueOf()):"string"==typeof e[r].toString()?t.push(e[r].toString()):t.push("[object]");return t.join(", ")}return"[object]"},addSlashes:function(e){return e.replace(/(\.|\\|\/|\||\+|\$|\^)/g,"\\$1")},filterTrace:function(e){var t=new RegExp("((?!\n).)*"+w.addSlashes(o)+".*\n","g");return e.replace(t,"")},getUserAgent:function(){return e.navigator.userAgent},getCurrentURL:function(){return $.length<1?e.location.href:$[$.length-1]},getRefererURL:function(){return $.length<2?t.referrer:$[$.length-2]},getRoute:function(e,t){if(t)for(var r=0;r<t.length;r++){var n=e.match(t[r][0]);if(n)return t[r][1].replace(/\$(\d+)/g,function(){return n[arguments[1]]||"$"+arguments[1]})}return e},getViewPortSize:function(){return{w:e.innerWidth,h:e.innerHeight,r:e.devicePixelRatio}},getClientID:function(){return e.localStorage?(e.localStorage.getItem("frontjs:client:id")||e.localStorage.setItem("frontjs:client:id",w.getGUID()),e.localStorage.getItem("frontjs:client:id")):w.getGUID()},getSessionID:function(){return e.sessionStorage?(e.sessionStorage.getItem("frontjs:session:id")||e.sessionStorage.setItem("frontjs:session:id",w.getGUID()),e.sessionStorage.getItem("frontjs:session:id")):w.getGUID()},checkCrossOrigin:function(e,t){if(t){e=e||"";for(var r=!1,n=0;n<t.length;n++)""!==t[n]&&e.match(t[n])&&(r|=!0);return!r}return!1},checkTimingSlow:function(e,t){return!!t&&(e.send>t.sned&&t.sned>0||e.load>t.load&&t.load>0||e.total>t.total&&t.total>0)},calculateTrackerTiming:function(e){if(e._time_done&&e._time_load&&e._time_send&&e._time_done){var t=e._time_send-e._time_open,r=e._time_load-e._time_send,n=e._time_done-e._time_open;return{send:t=t<0?null:t,load:r=r<0?null:r,total:n=n<0?null:n}}return{send:0,load:0,total:0}},getResourceTimingData:function(t){var r=e.performance&&e.performance.getEntriesByType&&e.performance.getEntriesByType("resource");if(!r)return null;for(var n=r.length-1;n>=0;n--){if(t.length&&r[n].name.length&&r[n].name.substring(r[n].name.length-t.length)===t){var o={};if(o.dns=r[n].domainLookupEnd-r[n].domainLookupStart,o.connect=r[n].connectEnd-r[n].connectStart,o.request=r[n].responseStart-r[n].requestStart,o.response=r[n].responseEnd-r[n].responseStart,o.dns>=0&&o.connect>=0&&o.request>=0&&o.response>=0)return o}return null}},composeTrackerData:function(e,t){return{type:e,data:t}},composeScriptErrorData:function(e,t,r,n,o,a){return a=a&&a.stack?a.stack.toString():"",{message:e,detail:{err:t,file:r,line:n,column:o,trace:a=w.filterTrace(a)}}},composeXHRErrorData:function(e,t,r,n){return{message:e,detail:{requestURL:t,responseData:r,timing:n}}},composeResourceErrorData:function(e,t,r){return{message:e,detail:{tagname:t,resourceURL:r}}},composePerformaceData:function(e,t){return{message:e,detail:t}}},T=function(t){var r={},a=!0;if(k(t.token)?(D(1001),a&=!1):r.token=t.token.toString(),R(t.behaviour)?(D(1002),a&=!1):(r.behaviour=parseInt(t.behaviour),r.behaviour||(r.behaviour=s|u|c|l)),L(t.origin)){var i=L(t.behaviour);D(1003,i),a&=!1}else r.origin=w.uriArrayCopy(t.origin),r.origin.push(e.location.origin),r.origin.push(/^((?!:\/\/).)*$/),r.origin.push(o),r.origin.push(n);return L(t.exclude)?(i=L(t.exclude),D(1004,i),a&=!1):(r.exclude=w.uriArrayCopy(t.exclude),r.exclude.push(o),r.exclude.push(n)),I(t.userData)?(i=I(t.userData),D(1005,i),a&=!1):r.userData=w.KVArrayCopy(t.userData),t.optimisedForSPA?(r.optimisedForSPA=!!t.optimisedForSPA,r.useHistory=!!t.useHistory):(r.optimisedForSPA=!1,r.useHistory=!1),C(t.routeMapping)?(i=C(t.routeMapping),D(1007,i),a&=!1):r.routeMapping=w.routeArrayCopy(t.routeMapping),!!a&&r}(r);if(!T)return D(4e3),!1;var b=e.XMLHttpRequest;if(e.XMLHttpRequest=function(){var e=new b;return e._tracker_open=e.open,e.tracker={_time_init:0,_time_open:0,_time_send:0,_time_load:0,_time_done:0,_request_method:"",_request_url:"",_status:""},e.addEventListener("error",O),e.addEventListener("timeout",O),e.addEventListener("readystatechange",O),e.open=function(t,r,n,o,a){return e.tracker._request_method=t,e.tracker._request_url=r,e.tracker._time_open=w.getTime(),e._tracker_open(t,r,!1!==n,o,a)},e},e.console){var U=e.console.log,q=e.console.warn,P=e.console.error;e.console.log=function(){var t=[].slice.call(arguments);if(!t.length)return!0;var r=w.composeScriptErrorData(257,w.stringifyParameter(t).substr(0,1e3),"via console.log",0,0,new Error(w.stringifyParameter(t).substr(0,1e3)));T.behaviour&s&&B(f,r),U.apply(e.console,t)},e.console.warn=function(){var t=[].slice.call(arguments);if(!t.length)return!0;var r=w.composeScriptErrorData(258,w.stringifyParameter(t).substr(0,1e3),"via console.warn",0,0,new Error(w.stringifyParameter(t).substr(0,1e3)));T.behaviour&s&&B(f,r),q.apply(e.console,t)},e.console.error=function(){var t=[].slice.call(arguments);if(!t.length)return!0;var r=w.composeScriptErrorData(259,w.stringifyParameter(t).substr(0,1e3),"via console.error",0,0,new Error(w.stringifyParameter(t).substr(0,1e3)));T.behaviour&s&&B(f,r),P.apply(e.console,t)}}if(e.fetch){var A=e.fetch;e.fetch=function(){var t=[].slice.call(arguments),r=w.getTime(),n=A.apply(e,t);return n.then(function(e){var n=w.getTime()-r;if(w.checkCrossOrigin(t[0],T.origin)){var o=w.composeXHRErrorData(S,t[0],{status:e.status},{send:n,load:null,total:n});B(v,o)}e.ok?(o=w.composeXHRErrorData(_,t[0],{status:e.status},{send:n,load:null,total:n}),B(v,o)):(o=w.composeXHRErrorData(h,t[0],{status:e.status},{send:n,load:null,total:n}),B(v,o))}),n}}if(T.optimisedForSPA&&T.useHistory&&e.history){var j=e.history.pushState;e.history.pushState=function(){var t=[].slice.call(arguments);j.apply(e.history,t),M(),X()};var H=e.history.replaceState;e.history.replaceState=function(){var t=[].slice.call(arguments);H.apply(e.history,t),M(),X()}}function x(e){if(!e.message)return!0;var t=w.composeScriptErrorData(f,e.message,e.filename,e.lineno,e.colno,e.error);w.checkCrossOrigin(e.filename,T.exclude)&&T.behaviour&s&&B(f,t)}function F(e){var t=e.target.tagName,r=e.target.src||e.target.href;if(!(w.checkCrossOrigin(r,T.exclude)&&T.behaviour&u&&r))return!0;if("load"===e.type){var n=w.getResourceTimingData(r);if(w.checkCrossOrigin(r,T.origin)){var o=w.composeResourceErrorData(g,t,r);B(m,o,n)}else n&&(o=w.composeResourceErrorData(d,t,r),B(m,o,n))}else"error"===e.type&&(o=w.composeResourceErrorData(p,t,r),B(m,o))}function O(e){var t=e.target;if(!(w.checkCrossOrigin(t.tracker._request_url,T.exclude)&&T.behaviour&c))return!0;if("readystatechange"===e.type){var r=["_time_init","_time_open","_time_send","_time_load","_time_done"];if(r[t.readyState]&&(t.tracker[r[t.readyState]]=w.getTime()),4===t.readyState){t.tracker._status=t.status;var n=w.calculateTrackerTiming(t.tracker),o=w.getResourceTimingData(t.tracker._request_url);if(w.checkCrossOrigin(t.tracker._request_url,T.origin)){var a=w.composeXHRErrorData(S,t.tracker._request_url,{status:t.tracker._status},n);B(v,a,o)}(n.send||n.load||n.total||t.tracker._status)&&(a=t.tracker._status>=200&&t.tracker._status<300?w.composeXHRErrorData(_,t.tracker._request_url,{status:t.tracker._status},n):w.composeXHRErrorData(h,t.tracker._request_url,{status:t.tracker._status},n),B(v,a,o))}}else"error"===e.type?(t.tracker._status=t.status,a=w.composeXHRErrorData(h,t.tracker._request_url,{status:t.tracker._status},n),B(v,a)):"timeout"===e.type&&(t.tracker._status=t.status,a=w.composeXHRErrorData(y,t.tracker._request_url,{status:t.tracker._status},n),B(v,a))}function M(t){if(e.performance&&e.performance.timing&&T.behaviour&l){var r={};r.dns=e.performance.timing.domainLookupEnd-e.performance.timing.domainLookupStart,r.connect=e.performance.timing.connectEnd-e.performance.timing.connectStart,r.request=e.performance.timing.responseStart-e.performance.timing.requestStart,r.response=e.performance.timing.responseEnd-e.performance.timing.responseStart,r.dom=e.performance.timing.domInteractive-e.performance.timing.domLoading,r.domContent=e.performance.timing.domComplete-e.performance.timing.domInteractive,r.load=e.performance.timing.domComplete-e.performance.timing.domainLookupStart,r.view=(new Date).getTime()-V,r.dns=r.dns<0?null:r.dns,r.connect=r.connect<0?null:r.connect,r.request=r.request<0?null:r.request,r.response=r.response<0?null:r.response,r.dom=r.dom<0?null:r.dom,r.domContent=r.domContent<0?null:r.domContent,r.load=r.load<0?null:r.load,r.view=r.view<0?null:r.view;var n=w.composePerformaceData(E,r);B(E,n)}}function X(t){if(e.performance&&e.performance.timing&&T.behaviour&l){var r={};r.dns=e.performance.timing.domainLookupEnd-e.performance.timing.domainLookupStart,r.connect=e.performance.timing.connectEnd-e.performance.timing.connectStart,r.request=e.performance.timing.responseStart-e.performance.timing.requestStart,r.response=e.performance.timing.responseEnd-e.performance.timing.responseStart,r.dom=e.performance.timing.domInteractive-e.performance.timing.domLoading,r.domContent=e.performance.timing.domComplete-e.performance.timing.domInteractive,r.load=e.performance.timing.domComplete-e.performance.timing.domainLookupStart,r.dns=r.dns<0?null:r.dns,r.connect=r.connect<0?null:r.connect,r.request=r.request<0?null:r.request,r.response=r.response<0?null:r.response,r.dom=r.dom<0?null:r.dom,r.domContent=r.domContent<0?null:r.domContent,r.load=r.load<0?null:r.load,J=w.getGUID(),$.push(e.location.href),V=V?(new Date).getTime():e.performance.timing.domComplete;var n=w.composePerformaceData(E,r);B(E,n),W.dispatchEvent({type:"enterpage",url:w.getCurrentURL(),referer:w.getRefererURL(),route:w.getRoute(w.getCurrentURL(),T.routeMapping),refererRoute:w.getRoute(w.getRefererURL(),T.routeMapping)})}}function G(e){M(),X()}var J=null,$=[],V=null;function B(e,t,r){var n=!1,o=w.composeTrackerData(e,t);if(o.currentURL=w.getCurrentURL(),o.refererURL=w.getRefererURL(),o.currentRoute=w.getRoute(o.currentURL,T.routeMapping),o.refererRoute=w.getRoute(o.refererURL,T.routeMapping),o.viewPort=w.getViewPortSize(),o.userAgent=w.getUserAgent(),o.clientID=w.getClientID(),o.sessionID=w.getSessionID(),e===E?(o.messageID=J,n=!0):o.messageID=w.getGUID(),o.token=T.token,o.version=a,o.userData=T.userData,r)for(var i in o.data.detail=o.data.detail||{},r)o.data.detail[i]=r[i];setTimeout(function(){N(o,n)},0)}var z=[],K=null;function N(t,r){if(t&&z.push(t),r&&z.length){var o=new e.XMLHttpRequest;o.open("POST",n,!0),o.send(e.JSON.stringify(z)),z=[],e.clearTimeout(K)}}K=function t(){K=e.setTimeout(function(){N(null,!0),t()},i)}(),e.addEventListener("beforeunload",M,!0),e.addEventListener("load",X,!0),e.addEventListener("error",x,!0),t.addEventListener("error",F,!0),t.addEventListener("load",F,!0),T.optimisedForSPA&&T.useHistory?e.addEventListener("popstate",G,!0):T.optimisedForSPA&&e.addEventListener("hashchange",G,!0);var W=function(t){var r=[];function n(e){return e.message||(e=new Error(e)),e.error=e,e.filename=e.filename?e.filename:"",e.filename+=" via frontJS try - catch API",e.lineno=e.lineno?e.lineno:0,e.colno=e.colno?e.colno:0,x(e),null}return{try:function(){var e=arguments[0],t=arguments[1];try{return e.apply(t,[].slice.call(arguments,2))}catch(e){return n(e)}},catch:n,addEventListener:function(e,t){r[e]=r[e]?r[e]:[];for(var n=0;n<r[e].length;n++)if(t===r[e])return t;return r[e].push(t),t},removeEventListener:function(e,t){r[e]=r[e]?r[e]:[];for(var n=[],o=0;o<r[e].length;o++)t!==r[e][o]&&n.push(r[e][o]);return r[e]=n,t},dispatchEvent:function(t){var n=t.type;if("string"==typeof n){r[n]=r[n]?r[n]:[];for(var o=0;o<r[n].length;o++)"function"==typeof r[n][o]&&e.setTimeout(function(e){return function(){r[n][e](t)}}(o),0)}},composedTry:function(e,t){return function(){try{return e.apply(t,[].slice.call(arguments))}catch(e){return n(e)}}},addUserData:function(e,r){return t.userData[e]=r,!0},removeUserData:function(e){return delete t.userData[e],!0}}}(T);return{C:{SCRIPT:s,RESOURCE:u,XHR:c,PERFOMACE:l},V:a,try:W.try,catch:W.catch,addEventListener:W.addEventListener,removeEventListener:W.removeEventListener,composedTry:W.composedTry,addUserData:W.addUserData,removeUserData:W.removeUserData}}(window,document,window.frontjsConfig);
//# sourceMappingURL=tracker.min.js.map